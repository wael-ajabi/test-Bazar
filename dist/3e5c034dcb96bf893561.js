var player,computer,ball,playerServe,lightningForge,goalWaitPeriod=!1,sparks=[],isPlayerForcePush=!1,isCompForcePush=!1,xoff=0;function setup(){var e=window.innerHeight<=542?window.innerHeight-20:522,t=window.innerWidth<=957?window.innerWidth-20:937;createCanvas(t,e).parent("p5Div"),player=new Player,computer=new Computer,ball=new Ball(width/2,height/2),scoreboard=new Scoreboard,playerServe=!0,lightningForge=new LightningForge,textSize(32),textFont("Futura")}function draw(){goalWaitPeriod&&translate(random(-13,13),random(-13,13)),background(25),stroke(255),line(width/2,0,width/2,height),player.update(),keyIsDown(UP_ARROW)?player.move(0,-7):keyIsDown(DOWN_ARROW)&&player.move(0,7),player.show(),isPlayerForcePush&&player.paddle.forceUpdate("player"),computer.update(),isCompForcePush&&computer.paddle.forceUpdate("computer"),computer.show(),text(scoreboard.playerScore+" / 7",width/2-140,60),text(scoreboard.computerScore+" / 7",width/2+60,60);for(var e=sparks.length-1;e>=0;e--)sparks[e].update(),sparks[e].show(),sparks[e].done()&&sparks.splice(e,1);if(scoreboard.gameOver()){fill(25,123),noStroke(),rect(0,0,width,height),fill(255);var t=scoreboard.playerScore>scoreboard.computerScore?"You win! ":"You lose! ";text(t+scoreboard.playerScore+" to "+scoreboard.computerScore+".",width/2-130,height/2-40),text("Press spacebar to play again.",width/2-220,height/2)}else goalWaitPeriod||(lightningForge.forgeIsFormed()?(ball.update(),ball.show()):(lightningForge.update(),lightningForge.show()))}function keyPressed(){scoreboard.gameOver&&32===keyCode&&scoreboard.resetScore()}function Paddle(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s,this.xspeed=0,this.yspeed=0,this.forcePushTime=0,this.show=function(){isPlayerForcePush?fill(255):fill(240),rect(this.x,this.y,this.width,this.height,5)},this.forceUpdate=function(e){this.forcePushTime<6?(this.x-=1,this.width+=2,this.y-=1,this.height+=2,this.forcePushTime+=1):this.forcePushTime<12?(this.x+=1,this.width-=2,this.y+=1,this.height-=2,this.forcePushTime+=1):("player"===e?isPlayerForcePush=!1:isCompForcePush=!1,this.forcePushTime=0)}}function Scoreboard(){this.playerScore=0,this.computerScore=0,this.gameOver=function(){return 7===this.playerScore||7===this.computerScore},this.resetScore=function(){this.playerScore=0,this.computerScore=0},this.playerScored=function(){this.playerScore+=1},this.computerScored=function(){this.computerScore+=1}}function Player(){this.paddle=new Paddle(30,height/2-25,20,70),this.update=function(){this.paddle.xspeed=0,this.paddle.yspeed=0},this.move=function(e,t){this.paddle.x+=e,this.paddle.y+=t,this.paddle.xspeed=e,this.paddle.yspeed=t,this.paddle.y<0?(this.paddle.y=0,this.paddle.yspeed=0):this.paddle.y+this.paddle.height>height&&(this.paddle.y=height-this.paddle.height,this.paddle.yspeed=0)},this.show=function(){this.paddle.show()}}function Computer(){this.paddle=new Paddle(width-50,height/2-25,20,70),this.move=function(e,t){this.paddle.x+=e,this.paddle.y+=t,this.paddle.xspeed=e,this.paddle.yspeed=t,this.paddle.y<0?(this.paddle.y=0,this.paddle.yspeed=0):this.paddle.y+this.paddle.height>height&&(this.paddle.y=height-this.paddle.height,this.paddle.yspeed=0)},this.update=function(){var e=ball.y,t=-(this.paddle.y+this.paddle.height/2-e);t<0&&t<-4?t=-8:t>0&&t>4&&(t=8),this.move(0,t),this.paddle.y<0?this.paddle.y=0:this.paddle.y+this.paddle.height>height&&(this.paddle.y=height-this.paddle.height)},this.show=function(){this.paddle.show()}}function Ball(e,t){this.x=e,this.y=t,this.xspeed=-6,this.yspeed=random(-1,1),this.vel=createVector(this.xspeed,this.yspeed),this.radius=40,this.yoff=random(1e3),this.resetBall=function(){this.x=width/2,this.y=height/2,this.xspeed=playerServe?-6:6,this.yspeed=random(-1,1),this.vel.x=this.xspeed,this.vel.y=this.yspeed},this.inDangerZone=function(e,t){return e<200||e>width-200},this.update=function(){if(this.x+=this.xspeed,this.y+=this.yspeed,this.vel.x=this.xspeed,this.vel.y=this.yspeed,this.y-this.radius<=0?(this.y=this.radius,this.yspeed=-this.yspeed):this.y+this.radius>height&&(this.y=height-this.radius,this.yspeed=-this.yspeed),this.x-this.radius/2<0||this.x+this.radius/2>width){var e=this.x-this.radius/2<0?0:width;shootSparks(e,this.y,-this.xspeed),goalWaitPeriod=!0,setTimeout((function(){goalWaitPeriod=!1,lightningForge.resetLightningForge()}),500),0===e?scoreboard.computerScored():scoreboard.playerScored(),playerServe=!playerServe,this.resetBall()}var t=player.paddle,i=computer.paddle;this.y+this.radius/2>=t.y&&this.y-this.radius/2<=t.y+t.height&&this.x-this.radius/2<=t.x+t.width&&(this.yspeed+=t.yspeed/2,isPlayerForcePush=!0,this.xspeed=10,this.x+=this.xspeed),this.y+this.radius/2>=i.y&&this.y-this.radius/2<=i.y+i.height&&this.x+this.radius/2>=i.x&&(isCompForcePush=!0,this.xspeed=-10,this.yspeed+=i.yspeed/2,this.x+=this.xspeed)},this.show=function(){if(!goalWaitPeriod){noStroke(),fill(100);var e=this.inDangerZone(this.x,this.y);push(),translate(this.x,this.y),rotate(this.vel.heading()-80);var t=0*this.radius;fill(226,228,236),rectMode(CENTER),rect(t,t,80,60,15,15,15),fill(2,44,80),rectMode(CENTER),rect(t,t,60,40,15,15,15),this.yoff+=.08;var i=.23*this.radius;stroke(3,253,255),fill(3,253,255),e?(text("^",2*-i,10),text("^",i/2,10)):(ellipse(-i,7-i,.26*this.radius,.5*this.radius),ellipse(i,7-i,.26*this.radius,.5*this.radius)),pop()}}}function shootSparks(e,t,i){for(var s=0;s<50;s++){var h=new Spark(e,t,i);sparks.push(h)}}function Spark(e,t,i){this.pos=createVector(e,t),this.lifespan=255,this.vel=createVector(random(0,i),random(-i,i)),this.vel.normalize(),this.vel.mult(random(0,10)),this.update=function(){this.vel.mult(.95),this.lifespan-=5,this.pos.add(this.vel)},this.done=function(){return this.lifespan<0},this.show=function(){this.done()||(noStroke(),fill(255,this.lifespan),rect(this.pos.x,this.pos.y,this.lifespan/20,this.lifespan/20,3))}}function LightningForge(){this.x=width/2,this.y=height/2,this.lifespan=355,this.history=[],this.resetLightningForge=function(){this.x=width/2,this.y=height/2,this.lifespan=355,this.history=[]},this.forgeIsFormed=function(){return this.lifespan<0},this.update=function(){this.lifespan-=5;for(var e=0;e<this.history.length;e++)this.history[e].x+=random(-2,2),this.history[e].y+=random(-5,5);var t=createVector(this.x,this.y);this.history.push(t),this.history.length>100&&this.history.splice(0,1)},this.show=function(){push(),stroke(255),strokeWeight(4),line(width/2,0,width/2,height),noFill(),beginShape();for(var e=0;e<this.history.length;e++){var t=this.history[e];vertex(t.x,t.y)}endShape(CLOSE),pop()}}